<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.maoding.admin.module.historyData.dao.CompanyDAO">
    <select id="getCompanyIdByCompanyNameAndUserName" parameterType="java.util.Map" resultType="java.lang.String">
        select c.id
        from
            maoding_web_company_user a
            inner join maoding_web_account b on (a.user_id=b.id)
            inner join maoding_web_company c on (a.company_id=c.id)
            left join maoding_web_business_partner d on (c.id=d.company_id)
        where
            (a.user_name=#{userName} or b.user_name=#{userName})
            and (c.company_name=#{companyName} or c.company_short_name=#{companyName} or d.nick_name=#{companyName})
        limit 1
    </select>
    <select id="getCompanyIdByCompanyNameForA" parameterType="java.util.Map" resultType="java.lang.String">
        select a.id
        from
            maoding_web_project_construct a
        where
            (a.company_name=#{companyName}) and (a.company_id=#{relateCompanyId})
        limit 1
    </select>
    <select id="getCompanyIdByCompanyNameForB" parameterType="java.util.Map" resultType="java.lang.String">
        select id
        from
            (   #本公司
                    select
                        a.id,
                        a.company_name,
                        a.company_short_name
                    from maoding_web_company a
                    where a.id = #{relateCompanyId}
                union #上一级父公司
                    select
                        x.id,
                        x.company_name,
                        x.company_short_name
                    from
                        maoding_web_company_relation a
                        inner join maoding_web_company x on (a.org_pid = x.id)
                    where
                        a.org_id = #{relateCompanyId}
                union #上两级父公司
                    select
                        x.id,
                        x.company_name,
                        x.company_short_name
                    from
                        maoding_web_company_relation a
                        inner join maoding_web_company b on (a.org_pid = b.org_id)
                        inner join maoding_web_company x on (b.org_pid = x.id)
                    where
                        a.org_id = #{relateCompanyId}
                union #上三级父公司
                    select
                        x.id,
                        x.company_name,
                        x.company_short_name
                    from
                        maoding_web_company_relation a
                        inner join maoding_web_company b on (a.org_pid = b.org_id)
                        inner join maoding_web_company c on (b.org_pid = c.org_id)
                        inner join maoding_web_company x on (c.org_pid = x.id)
                    where
                        a.org_id = #{relateCompanyId}
            ) h
            left join maoding_web_business_partner i on (h.id=i.company_id)
        where (h.company_name=#{companyName} or h.company_short_name=#{companyName} or i.nick_name=#{companyName})
        limit 1
    </select>
</mapper>